<script>
    // var urlParams = new URLSearchParams(window.location.search);
    // var mac = urlParams.get('mac');
    var mac=localStorage.getItem("mac");
    console.log(mac);
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/js/bootstrap.min.js"></script>

             <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
                    <div class="sub-form">
                          
                        <form action="" method="" class="login100-form" role="form">
                          
                                
                            <div class="wrap-input100">
                                <input id="mobile" class="input100 has-val" placeholder="Mobile" name="mobile" type="tel" size="18" required />
                                <!-- <span class="focus-input100"></span>
                                <span class="label-input100">Mobile</span> -->
            <!-- <label for="mobile" class="float-label">Mobile</label> -->
        </div>

                            <div class="radio">
                                <div class="radio-inner">
                                    <input type="radio" name="sex" value="f" data-icon='\f182' />
                                    <input type="radio" name="sex" value="m" data-icon='\f183' />
                                </div>
                            </div>

        <div class="wrap-input100">
            <input id="age" class="input100 has-val" name="age" type="number" size="14" min="10" max="99" required
                placeholder="Age from  10-99" />
            <!-- <span class="focus-input100"></span>
                                <span class="label-input100">Age</span> -->
                            </div>

                            <div class="signup">
                                <button class="btn btn-1" type="submit" name="Submit"
                                    id = "loadValidation" data-loading-text="<i class='fa fa-spinner fa-spin fa-2x'></i> Sending Code ...">Send me Validation
                                    SMS</button>
                            </div>

                            <div class="alert alert-danger" style = "width: 100%" role="alert">
                                    A simple danger alertâ€”check it out!
                            </div>
                        </form>

                    </div>
                </div>
    <script src="./phone_country_code/intl-tel-input-15.0.0/build/js/intlTelInput.js"></script>
    <script>
        var input = document.querySelector("#mobile");
        window.intlTelInput(input, {
        initialCountry: "auto",
        geoIpLookup: function (callback) {
            $.get('https://ipinfo.io', function () { }, "jsonp").always(function (resp) {
                var countryCode = (resp && resp.country) ? resp.country : "";
                callback(countryCode);
            });
        },
        utilsScript: "./phone_country_code/intl-tel-input-15.0.0/build/js/utils.js" // just for formatting/placeholders etc
    });

</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>
    $("#loadValidation").click(function (e) {

        e.preventDefault();
        var $this = $(this);
        let mobile = $("#mobile").val();
        let age = $("#age").val();
        let gender = $('input[name=sex]:checked').val();


        if (!(mobile && age && gender)) {

            $(".alert-danger").css({
                display: 'block',
            });
            $(".alert-danger").html("<p> Sorry but all Field must be filled");
        }
        else if (!$.isNumeric(mobile)) {
            $(".alert-danger").css({
                display: 'block',
            });
            $(".alert-danger").html("<p> Sorry but mobile must be a valid phone number");
        }
        else if (!$.isNumeric(age) || !(age > 10 && age < 99)) {
            $(".alert-danger").css({
                display: 'block',
            });
            $(".alert-danger").html("<p> Sorry but age must be a number between 10 and 99");
        }
        else {
            $(".alert-danger").css({
                display: 'none',
            });
            $this.button('reset');
            $this.button('loading');
            $this.attr("disabled",true) ; 
            fetch("http://hoopoeapi.herokuapp.com/users", {
                method: 'POST',
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    "phone": mobile,
                    "age": parseInt(age),
                    "gender": gender,
                    "mac": mac
                })
            })
                .then((response) => {
                    return response.json()
                }).then((response) => {
                    console.log(response);
                    if (response.status === "success") {
                        console.log('success');
                        localStorage.setItem('phone',mobile);
                        $( "#rightSide" ).load("./asset_files/pages/validation.html");  
                    }
                    else {
                        console.log('fail');
                        $("#loadValidation").attr("disabled",false) ; 
                        $("#loadValidation").button("reset") ; 
                        $(".alert-danger").css({
                            display: 'block',
                        });
                        $(".alert-danger").html("<p>" + response.message ? response.message!= "undefined" : "Sorry but service not available Now " + "</p>");

                        $( "#rightSide" ).load("./asset_files/pages/validation.html");  

                    }
                })
            // localStorage.setItem("mobile", mobile);
        }
    })

</script>

<!-- <script src = "asset_files/js/plugin.js"> </script> -->
